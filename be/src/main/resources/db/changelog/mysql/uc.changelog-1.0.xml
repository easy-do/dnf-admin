<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.1.xsd">

    <changeSet author="yuzhanfeng" id="20231028" dbms="mysql" failOnError="true">
        <sql dbms="mysql">

            -- d_taiwan.da_item definition

            CREATE TABLE `da_item`
            (
                `id`     bigint(20)  NOT NULL COMMENT '装备id',
                `name`   varchar(64) NOT NULL COMMENT '名称',
                `type`   varchar(12) DEFAULT NULL COMMENT '类型',
                `rarity` varchar(6)  DEFAULT NULL COMMENT '稀有度',
                PRIMARY KEY (`id`)
            ) ENGINE = InnoDB
              DEFAULT CHARSET = utf8 COMMENT ='物品缓存';


            -- d_taiwan.da_sign_in_conf definition

            CREATE TABLE `da_sign_in_conf`
            (
                `id`          bigint(20)  NOT NULL AUTO_INCREMENT,
                `config_name` varchar(32) NOT NULL COMMENT '配置名称',
                `config_date` date        NOT NULL COMMENT '签到时间',
                `config_json` text        NOT NULL COMMENT '配置数据',
                `remark`      varchar(100) DEFAULT NULL COMMENT '备注',
                `create_id`   int(11)      DEFAULT NULL,
                `create_time` datetime     DEFAULT NULL,
                `update_time` datetime     DEFAULT NULL,
                PRIMARY KEY (`id`)
            ) ENGINE = InnoDB
              AUTO_INCREMENT = 14
              DEFAULT CHARSET = utf8mb4 COMMENT ='签到配置';

            -- d_taiwan.da_sign_in_log definition

            CREATE TABLE `da_sign_in_log`
            (
                `id`              bigint(20) NOT NULL AUTO_INCREMENT,
                `config_id`       bigint(20) NOT NULL,
                `data_json`       text COMMENT '签到信息',
                `sign_in_role_id` int(11)  DEFAULT NULL COMMENT '签到角色',
                `create_time`     datetime DEFAULT NULL COMMENT '签到时间',
                `update_time`     datetime DEFAULT NULL,
                PRIMARY KEY (`id`)
            ) ENGINE = InnoDB
              AUTO_INCREMENT = 17
              DEFAULT CHARSET = utf8mb4 COMMENT ='签到记录';

            -- d_taiwan.da_game_config definition

            CREATE TABLE `da_game_config`
            (
                `id`        bigint(20)  NOT NULL COMMENT 'id',
                `conf_name` varchar(64) NOT NULL COMMENT '配置名称',
                `conf_type` int(2)      NOT NULL DEFAULT '0' COMMENT '配置类型',
                `conf_data` text        NOT NULL COMMENT '配置信息',
                `conf_key`  varchar(64) NOT NULL COMMENT '配置标签',
                `remark`    varchar(100)         DEFAULT NULL COMMENT '备注',
                PRIMARY KEY (`id`)
            ) ENGINE = InnoDB
              DEFAULT CHARSET = utf8 COMMENT ='游戏配置';
        </sql>
    </changeSet>
    <changeSet author="yuzhanfeng" id="20231029" dbms="mysql" failOnError="true">
        <sql dbms="mysql">
            -- d_taiwan.da_notice_send_log definition

            CREATE TABLE `da_notice_send_log`
            (
                `id`          bigint(20) NOT NULL AUTO_INCREMENT,
                `message`     text COMMENT '消息',
                `create_time` datetime DEFAULT NULL COMMENT '发送时间',
                PRIMARY KEY (`id`)
            ) ENGINE = InnoDB
              DEFAULT CHARSET = utf8mb4 COMMENT ='公告发送记录';
        </sql>
    </changeSet>
    <changeSet author="yuzhanfeng" id="20231029-1" dbms="mysql" failOnError="true">
        <sql dbms="mysql">
            -- d_taiwan.da_mail_send_log definition

            CREATE TABLE `da_mail_send_log`
            (
                `id`           bigint(20) NOT NULL AUTO_INCREMENT,
                `send_details` text COMMENT '发送内容',
                `create_time`  datetime DEFAULT NULL COMMENT '发送时间',
                PRIMARY KEY (`id`)
            ) ENGINE = InnoDB
              DEFAULT CHARSET = utf8mb4 COMMENT ='邮件发送记录';
        </sql>
    </changeSet>
    <changeSet author="yuzhanfeng" id="20231029-2" dbms="mysql" failOnError="true">
        <sql dbms="mysql">
            ALTER TABLE da_item MODIFY COLUMN name varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT '名称';
        </sql>
    </changeSet>
    <changeSet author="yuzhanfeng" id="20231104" dbms="mysql" failOnError="true">
        <sql dbms="mysql">
            ALTER TABLE da_game_config MODIFY COLUMN id bigint(20) auto_increment NOT NULL COMMENT 'id';
        </sql>
    </changeSet>
    <changeSet author="yuzhanfeng" id="20231104-1" dbms="mysql" failOnError="true">
        <sql dbms="mysql">
            INSERT INTO da_game_config (id, conf_name, conf_type, conf_data, conf_key, remark) VALUES(1, '主线任务完成券', 1, '114154', 'complete_task_id', '主线任务完成券的道具id');
            INSERT INTO da_game_config (id, conf_name, conf_type, conf_data, conf_key, remark) VALUES(2, '强化增幅必成等级', 1, '15', 'upgrade_success_level', '强化或增幅等级多少以下不失败');
        </sql>
    </changeSet>
    <changeSet author="yuzhanfeng" id="20231105" dbms="mysql" failOnError="true">
        <sql dbms="mysql">
            UPDATE da_game_config SET conf_name='主线任务完成券', conf_type=1, conf_data='8070', conf_key='complete_task_item_id', remark='一键完成主线任务的道具id' WHERE id=1;
            UPDATE da_game_config SET conf_name='强化增幅必成等级', conf_type=1, conf_data='30', conf_key='upgrade_success_level', remark='强化或增幅多少级不失败' WHERE id=2;
        </sql>
    </changeSet>
    <changeSet author="yuzhanfeng" id="20231111" dbms="mysql" failOnError="true">
        <sql dbms="mysql">
            INSERT INTO da_game_config (conf_name, conf_type, conf_data, conf_key, remark) VALUES('等级上限', 1, '100', 'max_level', '立即生效');
            INSERT INTO da_game_config (conf_name, conf_type, conf_data, conf_key, remark) VALUES('绝望之塔通关后仍可继续挑战(需门票)', 3, 'false', 'unlimit_towerofdespair', '开启后再关闭需要重启服务端生效');
            INSERT INTO da_game_config (conf_name, conf_type, conf_data, conf_key, remark) VALUES('设置物品免确认(异界装备不影响)', 3, 'true', 'disable_item_routing', '开启后再关闭需要重启服务端生效');
            INSERT INTO da_game_config (conf_name, conf_type, conf_data, conf_key, remark) VALUES('解除100级及以上的限制', 3, 'false', 'disable_security_protection', '开启后再关闭需要重启服务端生效');
            INSERT INTO da_game_config (conf_name, conf_type, conf_data, conf_key, remark) VALUES('退出副本免虚弱', 3, 'false', 'disable_giveup_panalty', '开启后再关闭需要重启服务端生效');
            INSERT INTO da_game_config (conf_name, conf_type, conf_data, conf_key, remark) VALUES('解锁镇魂开门任务', 3, 'false', 'open_timegate', '开启后再关闭需要重启服务端生效');
            INSERT INTO da_game_config (conf_name, conf_type, conf_data, conf_key, remark) VALUES('允许创建缔造者', 3, 'false', 'enable_creator', '开启后再关闭需要重启服务端生效');
            INSERT INTO da_game_config (conf_name, conf_type, conf_data, conf_key, remark) VALUES('开启GM功能, (需要添加管理员账号ID至数据库中)', 3, 'false', 'enable_game_master', '开启后再关闭需要重启服务端生效');
            INSERT INTO da_game_config (conf_name, conf_type, conf_data, conf_key, remark) VALUES('关闭新账号发送的契约邮件', 3, 'false', 'disable_mobile_rewards', '开启后再关闭需要重启服务端生效');
            INSERT INTO da_game_config (conf_name, conf_type, conf_data, conf_key, remark) VALUES('解除交易限额, 已达上限的第二天生效', 3, 'false', 'disable_trade_limit', '开启后再关闭需要重启服务端生效');
            INSERT INTO da_game_config (conf_name, conf_type, conf_data, conf_key, remark) VALUES('设置使用拍卖行的最低等级', 1, '1', 'set_auction_min_level', '立即生效');
            INSERT INTO da_game_config (conf_name, conf_type, conf_data, conf_key, remark) VALUES('修复拍卖行消耗品上架, 设置最大总价, 建议值2E', 1, '200000000', 'fix_auction_regist_item', '立即生效');
            INSERT INTO da_game_config (conf_name, conf_type, conf_data, conf_key, remark) VALUES('关闭NPC回购系统', 3, 'false', 'disable_redeem_item', '开启后再关闭需要重启服务端生效');
            INSERT INTO da_game_config (conf_name, conf_type, conf_data, conf_key, remark) VALUES('禁用支援兵', 3, 'false', 'disable_striker', '开启后再关闭需要重启服务端生效');
            INSERT INTO da_game_config (conf_name, conf_type, conf_data, conf_key, remark) VALUES('禁用道具掉落随机强化', 3, 'false', 'disable_drop_random_upgrade', '开启后再关闭需要重启服务端生效');
            INSERT INTO da_game_config (conf_name, conf_type, conf_data, conf_key, remark) VALUES('装备解锁时间(秒)', 1, '86400', 'set_item_unlock_time', '立即生效');
            INSERT INTO da_game_config (conf_name, conf_type, conf_data, conf_key, remark) VALUES('掉落时随机赋予红字的装备最低等级 (默认55)', 1, '55', 'set_drop_amplify_level', '立即生效,影响洗红字的等级');
        </sql>
    </changeSet>
    <changeSet author="yuzhanfeng" id="20231112" dbms="mysql" failOnError="true">
        <sql dbms="mysql">
            INSERT INTO da_game_config (conf_name, conf_type, conf_data, conf_key, remark) VALUES('启动后自动加载pvf数据到数据库', 3, 'true', 'gm_reader_pvf', '后台参数,是否启动后加载pvf文件数据');
        </sql>
    </changeSet>
    <changeSet author="yuzhanfeng" id="20231114" dbms="mysql" failOnError="true">
        <sql dbms="mysql">
            -- da_resource definition

            CREATE TABLE `da_resource`
            (
                `id`            bigint(20)    NOT NULL AUTO_INCREMENT COMMENT 'ID',
                `parent_id`     bigint(20)             DEFAULT 0 COMMENT '父级ID',
                `resource_name` varchar(50)   NOT NULL COMMENT '资源名称',
                `resource_code` varchar(100)  NOT NULL COMMENT '资源编码',
                `resource_path` varchar(2048)          COMMENT '资源id路径，以/开始以/结束，从根节点ID到当点节点ID，节点ID之间以/连接',
                `resource_type` char(1)                DEFAULT '' COMMENT '资源类型（M菜单 F功能）',
                `order_number`  int(11)                DEFAULT 0 COMMENT '显示顺序',
                `url`           varchar(200)           DEFAULT '' COMMENT '路径',
                `icon`          text                   DEFAULT NULL COMMENT '图标',
                `status`        tinyint(1)             DEFAULT 1 COMMENT '状态（0停用 1开启）',
                `auth_flag`     tinyint(1)    NOT NULL DEFAULT 1 COMMENT '是否需要授权访问：1-是、0-否',
                `resource_desc` varchar(500)           DEFAULT '' COMMENT '备注',
                `del_flag`      tinyint(1)             DEFAULT 0 COMMENT '删除标记',
                PRIMARY KEY (`id`) USING BTREE
            ) ENGINE = InnoDB
              DEFAULT CHARSET = utf8mb4 COMMENT ='系统资源';

            -- da_role definition

            CREATE TABLE `da_role`
            (
                `id`     bigint(20)   NOT NULL AUTO_INCREMENT COMMENT '角色ID',
                `role_name`   varchar(30)  NOT NULL COMMENT '角色名称',
                `role_key`    varchar(100) NOT NULL COMMENT '角色权限字符串',
                `role_sort`   int(11)      NOT NULL DEFAULT 0 COMMENT '显示顺序',
                `is_default`  int(11)      NOT NULL DEFAULT 0 COMMENT '是否默认角色,0否 1是',
                `status`      int(11)      NOT NULL DEFAULT 1 COMMENT '角色状态（0停用 1开启）',
                `remark`      varchar(500)          DEFAULT NULL COMMENT '备注',
                PRIMARY KEY (`id`) USING BTREE
            ) ENGINE = InnoDB
              DEFAULT CHARSET = utf8mb4 COMMENT ='角色信息表';

            -- da_role_resource definition

            CREATE TABLE `da_role_resource`
            (
                `role_id`     bigint(20) NOT NULL COMMENT '角色ID',
                `resource_id` bigint(20) NOT NULL COMMENT '资源ID'
            ) ENGINE = InnoDB
              DEFAULT CHARSET = utf8mb4 COMMENT ='角色和资源关联表';

            -- da_user_role definition

            CREATE TABLE `da_user_role`
            (
                `user_id` bigint(20) NOT NULL COMMENT '用户ID',
                `role_id` bigint(20) NOT NULL COMMENT '角色ID',
                PRIMARY KEY (`user_id`, `role_id`) USING BTREE
            ) ENGINE = InnoDB
              DEFAULT CHARSET = utf8mb4 COMMENT ='用户和角色关联表';
        </sql>
    </changeSet>
    <changeSet author="yuzhanfeng" id="20231122" dbms="mysql" failOnError="true">
        <sql dbms="mysql">
            UPDATE da_game_config SET conf_name='启动后自动加载pvf数据到数据库', conf_type=3, conf_data='false', conf_key='gm_reader_pvf', remark='后台参数,是否启动后加载pvf文件数据' WHERE conf_key='gm_reader_pvf';
            INSERT INTO da_role (id, role_name, role_key, role_sort, is_default, status, remark) VALUES(1, '系统管理员', 'admin', 0, 0, 1, '系统管理员');
            INSERT INTO da_role (id, role_name, role_key, role_sort, is_default, status, remark) VALUES(2, '默认角色', 'default_role', 0, 1, 1, '系统默认角色');
            INSERT INTO da_resource (id, parent_id, resource_name, resource_code, resource_path, resource_type, order_number, url, icon, status, auth_flag, resource_desc, del_flag) VALUES(1, 0, '首页', 'home', '/home', 'M', 0, '', NULL, 1, 1, '', 0);
            INSERT INTO da_resource (id, parent_id, resource_name, resource_code, resource_path, resource_type, order_number, url, icon, status, auth_flag, resource_desc, del_flag) VALUES(2, 0, '签到配置', 'signIn', '/signin', 'M', 0, '', NULL, 1, 1, '', 0);
            INSERT INTO da_resource (id, parent_id, resource_name, resource_code, resource_path, resource_type, order_number, url, icon, status, auth_flag, resource_desc, del_flag) VALUES(3, 2, '添加签到', 'signIn.save', 'signIn.save', 'F', 0, '', NULL, 1, 1, '', 0);
            INSERT INTO da_resource (id, parent_id, resource_name, resource_code, resource_path, resource_type, order_number, url, icon, status, auth_flag, resource_desc, del_flag) VALUES(4, 2, '编辑签到', 'signIn.update', 'signIn.update', 'F', 0, '', NULL, 1, 1, '', 0);
            INSERT INTO da_resource (id, parent_id, resource_name, resource_code, resource_path, resource_type, order_number, url, icon, status, auth_flag, resource_desc, del_flag) VALUES(5, 0, '物品管理', 'item', '/item', 'M', 0, '', NULL, 1, 1, '', 0);
            INSERT INTO da_resource (id, parent_id, resource_name, resource_code, resource_path, resource_type, order_number, url, icon, status, auth_flag, resource_desc, del_flag) VALUES(6, 5, '添加物品', 'item.save', 'item.save', 'F', 0, '', NULL, 1, 1, '', 0);
            INSERT INTO da_resource (id, parent_id, resource_name, resource_code, resource_path, resource_type, order_number, url, icon, status, auth_flag, resource_desc, del_flag) VALUES(7, 5, '删除物品', 'item.remove', 'item.remove', 'F', 0, '', NULL, 1, 1, '', 0);
            INSERT INTO da_resource (id, parent_id, resource_name, resource_code, resource_path, resource_type, order_number, url, icon, status, auth_flag, resource_desc, del_flag) VALUES(8, 5, '模板导入', 'item.importItem', 'item.importItem', 'F', 0, '', NULL, 1, 1, '', 0);
            INSERT INTO da_resource (id, parent_id, resource_name, resource_code, resource_path, resource_type, order_number, url, icon, status, auth_flag, resource_desc, del_flag) VALUES(9, 5, '7z导入', 'item.importItemFor7z', 'item.importItemFor7z', 'F', 0, '', NULL, 1, 1, '', 0);
            INSERT INTO da_resource (id, parent_id, resource_name, resource_code, resource_path, resource_type, order_number, url, icon, status, auth_flag, resource_desc, del_flag) VALUES(10, 5, '编辑物品', 'item.update', 'item.update', 'F', 0, '', NULL, 1, 1, '', 0);
            INSERT INTO da_resource (id, parent_id, resource_name, resource_code, resource_path, resource_type, order_number, url, icon, status, auth_flag, resource_desc, del_flag) VALUES(11, 0, '游戏公告', 'notice', '/notice', 'M', 0, '', NULL, 1, 1, '', 0);
            INSERT INTO da_resource (id, parent_id, resource_name, resource_code, resource_path, resource_type, order_number, url, icon, status, auth_flag, resource_desc, del_flag) VALUES(12, 11, '发送公告', 'notice.sendNotice', 'notice.sendNotice', 'F', 0, '', NULL, 1, 1, '', 0);
            INSERT INTO da_resource (id, parent_id, resource_name, resource_code, resource_path, resource_type, order_number, url, icon, status, auth_flag, resource_desc, del_flag) VALUES(13, 0, '邮件系统', 'mail', '/mail', 'M', 0, '', NULL, 1, 1, '', 0);
            INSERT INTO da_resource (id, parent_id, resource_name, resource_code, resource_path, resource_type, order_number, url, icon, status, auth_flag, resource_desc, del_flag) VALUES(14, 13, '发送邮件', 'mail.sendMail', 'mail.sendMail', 'F', 0, '', NULL, 1, 1, '', 0);
            INSERT INTO da_resource (id, parent_id, resource_name, resource_code, resource_path, resource_type, order_number, url, icon, status, auth_flag, resource_desc, del_flag) VALUES(15, 0, '角色管理', 'role', '/role', 'M', 0, '', NULL, 1, 1, '', 0);
            INSERT INTO da_resource (id, parent_id, resource_name, resource_code, resource_path, resource_type, order_number, url, icon, status, auth_flag, resource_desc, del_flag) VALUES(16, 15, '添加角色', 'role.save', 'role.save', 'F', 0, '', NULL, 1, 1, '', 0);
            INSERT INTO da_resource (id, parent_id, resource_name, resource_code, resource_path, resource_type, order_number, url, icon, status, auth_flag, resource_desc, del_flag) VALUES(17, 15, '编辑角色', 'role.update', 'role.update', 'F', 0, '', NULL, 1, 1, '', 0);
            INSERT INTO da_resource (id, parent_id, resource_name, resource_code, resource_path, resource_type, order_number, url, icon, status, auth_flag, resource_desc, del_flag) VALUES(18, 15, '授权角色', 'role.authRoleResource', 'role.authRoleResource', 'F', 0, '', NULL, 1, 1, '', 0);
            INSERT INTO da_resource (id, parent_id, resource_name, resource_code, resource_path, resource_type, order_number, url, icon, status, auth_flag, resource_desc, del_flag) VALUES(19, 0, '系统配置', 'conf', '/conf', 'M', 0, '', NULL, 1, 1, '', 0);
            INSERT INTO da_resource (id, parent_id, resource_name, resource_code, resource_path, resource_type, order_number, url, icon, status, auth_flag, resource_desc, del_flag) VALUES(20, 19, '添加配置', 'conf.save', 'conf.save', 'F', 0, '', NULL, 1, 1, '', 0);
            INSERT INTO da_resource (id, parent_id, resource_name, resource_code, resource_path, resource_type, order_number, url, icon, status, auth_flag, resource_desc, del_flag) VALUES(21, 19, '更新配置', 'conf.update', 'conf.update', 'F', 0, '', NULL, 1, 1, '', 0);
            INSERT INTO da_role_resource (role_id, resource_id) VALUES(1, 1);
            INSERT INTO da_role_resource (role_id, resource_id) VALUES(1, 2);
            INSERT INTO da_role_resource (role_id, resource_id) VALUES(1, 3);
            INSERT INTO da_role_resource (role_id, resource_id) VALUES(1, 4);
            INSERT INTO da_role_resource (role_id, resource_id) VALUES(1, 5);
            INSERT INTO da_role_resource (role_id, resource_id) VALUES(1, 6);
            INSERT INTO da_role_resource (role_id, resource_id) VALUES(1, 7);
            INSERT INTO da_role_resource (role_id, resource_id) VALUES(1, 8);
            INSERT INTO da_role_resource (role_id, resource_id) VALUES(1, 9);
            INSERT INTO da_role_resource (role_id, resource_id) VALUES(1, 10);
            INSERT INTO da_role_resource (role_id, resource_id) VALUES(1, 11);
            INSERT INTO da_role_resource (role_id, resource_id) VALUES(1, 12);
            INSERT INTO da_role_resource (role_id, resource_id) VALUES(1, 13);
            INSERT INTO da_role_resource (role_id, resource_id) VALUES(1, 14);
            INSERT INTO da_role_resource (role_id, resource_id) VALUES(1, 15);
            INSERT INTO da_role_resource (role_id, resource_id) VALUES(1, 16);
            INSERT INTO da_role_resource (role_id, resource_id) VALUES(1, 17);
            INSERT INTO da_role_resource (role_id, resource_id) VALUES(1, 18);
            INSERT INTO da_role_resource (role_id, resource_id) VALUES(1, 19);
            INSERT INTO da_role_resource (role_id, resource_id) VALUES(1, 20);
            INSERT INTO da_role_resource (role_id, resource_id) VALUES(1, 21);
        </sql>
    </changeSet>
</databaseChangeLog>
